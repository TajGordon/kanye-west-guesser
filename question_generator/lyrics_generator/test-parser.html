<!DOCTYPE html>
<html>
<head>
    <title>Parser Test</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 4px; overflow: auto; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Parser Test</h1>
    <button onclick="runTest()">Run Test</button>
    <div id="output"></div>
    
    <script>
        async function runTest() {
            const testText = `[Verse 1]
First verse line 1
First verse line 2

[Verse 2]
Second verse line 1
Second verse line 2

[Verse 3]
Third verse line 1
Third verse line 2

[Chorus 1]
Chorus line 1
Chorus line 2

[Bridge 1]
Bridge line 1`;

            const output = document.getElementById('output');
            output.innerHTML = '<p>Testing...</p>';
            
            try {
                const response = await fetch('/api/parse', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: testText })
                });
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                
                // Group by section
                const sections = {};
                data.lines.forEach(line => {
                    if (line.section) {
                        const key = `${line.section.type}-${line.section.number}`;
                        if (!sections[key]) sections[key] = [];
                        sections[key].push(line);
                    }
                });
                
                let html = '<h2 class="success">✓ Parse Success</h2>';
                html += `<p>Total lines: ${data.lines.length}</p>`;
                html += '<h3>Sections Found:</h3><ul>';
                
                Object.entries(sections).sort().forEach(([key, lines]) => {
                    html += `<li><strong>${key}</strong>: ${lines.length} lines</li>`;
                });
                
                html += '</ul>';
                html += '<h3>Raw Output Sample:</h3><pre>';
                data.lines.slice(0, 5).forEach(line => {
                    html += `Type: ${line.section?.type || 'N/A'}, Num: ${line.section?.number || 'N/A'}, Content: "${line.content}"\n`;
                });
                html += '</pre>';
                
                output.innerHTML = html;
            } catch (error) {
                output.innerHTML = `<p class="error">✗ Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
